define(["require","./normalize"],function(e,t){function n(e){if("undefined"!=typeof process&&process.versions&&process.versions.node&&require.nodeRequire)try{var t=require.nodeRequire("csso"),n=e.length;return e=t.justDoIt(e),console.log("Compressed CSS output to "+Math.round(e.length/n*100)+"%."),e}catch(i){return console.log('Compression module not installed. Use "npm install csso -g" to enable.'),e}return console.log("Compression not supported outside of nodejs environments."),e}function i(e){if("undefined"!=typeof process&&process.versions&&process.versions.node&&require.nodeRequire){var t=require.nodeRequire("fs"),n=t.readFileSync(e,"utf8");return 0===n.indexOf("ï»¿")?n.substring(1):n}var i,r,n=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8"));try{for(i=new java.lang.StringBuffer,r=a.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),i.append(r);null!==(r=a.readLine());)i.append(s).append(r);return String(i.toString())}finally{a.close()}}function r(e,t){if("undefined"!=typeof process&&process.versions&&process.versions.node&&require.nodeRequire){var n=require.nodeRequire("fs");n.writeFileSync(e,t,"utf8")}else{var i=new java.lang.String(t),r=new java.io.BufferedWriter(new java.io.OutputStreamWriter(new java.io.FileOutputStream(e),"utf-8"));try{r.write(i,0,i.length()),r.flush()}finally{r.close()}}}function s(e){return e.replace(/(["'\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")}var a,o={},u=/^([^\:\/]+:\/)?\//,c=e.toUrl("base_url").split("/");c[c.length-1]="";var l,d=(c.join("/"),[]),h={};return o.load=function(e,n,r,s){if(l=l||s,a=a||path.resolve(l.dir||path.dirname(l.out),l.siteRoot||".")+"/",e.match(u))return r();var o=n.toUrl(e+".css");h[e]=t(i(o),o,a),r()},o.normalize=function(e,t){return".css"==e.substr(e.length-4,4)&&(e=e.substr(0,e.length-4)),t(e)},o.write=function(e,t,n){t.match(u)||(d.push(h[t]),0!=l.buildCSS&&n.asModule(e+"!"+t,"define(function(){})"))},o.onLayerEnd=function(e,t){var i=d.join("");if(l.separateCSS){console.log("Writing CSS! file: "+t.name+"\n");var a=l.appDir?l.baseUrl+t.name+".css":l.out.replace(/(\.js)?$/,".css");r(a,n(i))}else if(0!=l.buildCSS){if(""==i)return;e("(function(c){var d=document,a='appendChild',i='styleSheet',s=d.createElement('style');s.type='text/css';d.getElementsByTagName('head')[0][a](s);s[i]?s[i].cssText=c:s[a](d.createTextNode(c));})\n('"+s(n(i))+"');\n")}d=[]},o});